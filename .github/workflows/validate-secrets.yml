name: Validate Repository Secrets

on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.github/workflows/**'
      - 'terraform/**'

jobs:
  validate-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Required Secrets
        run: |
          echo "Validating required repository secrets..."

          # Check critical secrets for infrastructure deployment
          required_secrets=(
            "AWS_ACCESS_KEY_ID"
            "AWS_SECRET_ACCESS_KEY"
            "BASTION_PUBLIC_KEY"
            "BASTION_SSH_PRIVATE_KEY"
          )

          missing_secrets=()

          for secret in "${required_secrets[@]}"; do
            if [[ -z "${{ secrets[secret] }}" ]]; then
              missing_secrets+=("$secret")
            else
              echo "✅ $secret is configured"
            fi
          done

          if [[ ${#missing_secrets[@]} -gt 0 ]]; then
            echo ""
            echo "❌ Missing required secrets:"
            printf '  - %s\n' "${missing_secrets[@]}"
            echo ""
            echo "Please configure these secrets in repository settings:"
            echo "Settings → Secrets and variables → Actions → Repository secrets"
            exit 1
          else
            echo ""
            echo "✅ All required secrets are configured"
          fi