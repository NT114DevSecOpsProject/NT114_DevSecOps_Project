# ArgoCD Helm Values for Production Environment
# Configured with dedicated ArgoCD node group and internal ALB

## Global Configuration
global:
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

## Server Configuration
server:
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  # Service configuration - ClusterIP for ALB
  service:
    type: ClusterIP

  # Ingress for internal ALB
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internal  # Internal ALB (production)
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
      alb.ingress.kubernetes.io/backend-protocol: HTTP
      alb.ingress.kubernetes.io/healthcheck-path: /healthz
      alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
      alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
      alb.ingress.kubernetes.io/healthy-threshold-count: "2"
      alb.ingress.kubernetes.io/unhealthy-threshold-count: "2"
      alb.ingress.kubernetes.io/group.name: argocd-internal
    hosts:
      - argocd.internal.codeland.local
    paths:
      - /
    pathType: Prefix

  # Resource limits - Higher for production
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 256Mi

  # Replicas for high availability
  replicas: 2

## Repo Server Configuration
repoServer:
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 256Mi

  replicas: 2

  # Increase liveness probe timeout to prevent false failures under load
  livenessProbe:
    initialDelaySeconds: 30
    timeoutSeconds: 5

## Application Controller Configuration
controller:
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 512Mi

  replicas: 1  # StatefulSet - use HPA for scaling

## Redis Configuration
redis:
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi

## Dex Server Configuration (for SSO)
dex:
  enabled: true
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

## ApplicationSet Controller Configuration
applicationSet:
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi

  replicas: 2

## Notifications Controller Configuration
notifications:
  enabled: true
  tolerations:
    - key: workload
      operator: Equal
      value: argocd
      effect: NoSchedule

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

## Config Management
configs:
  params:
    # Enable insecure mode (HTTP) - ALB handles TLS
    server.insecure: true

  # Configure repository credentials if needed
  repositories: {}

  # RBAC configuration
  rbac:
    policy.default: role:readonly
    policy.csv: |
      p, role:admin, applications, *, */*, allow
      p, role:admin, clusters, *, *, allow
      p, role:admin, repositories, *, *, allow
      g, admin, role:admin
